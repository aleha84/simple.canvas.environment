(function(){"use strict";var i=typeof module!="undefined"&&module.exports,r=typeof Element!="undefined"&&"ALLOW_KEYBOARD_INPUT"in Element,n=function(){for(var t,r,i=[["requestFullscreen","exitFullscreen","fullscreenElement","fullscreenEnabled","fullscreenchange","fullscreenerror"],["webkitRequestFullscreen","webkitExitFullscreen","webkitFullscreenElement","webkitFullscreenEnabled","webkitfullscreenchange","webkitfullscreenerror"],["webkitRequestFullScreen","webkitCancelFullScreen","webkitCurrentFullScreenElement","webkitCancelFullScreen","webkitfullscreenchange","webkitfullscreenerror"],["mozRequestFullScreen","mozCancelFullScreen","mozFullScreenElement","mozFullScreenEnabled","mozfullscreenchange","mozfullscreenerror"],["msRequestFullscreen","msExitFullscreen","msFullscreenElement","msFullscreenEnabled","MSFullscreenChange","MSFullscreenError"]],n=0,f=i.length,u={};n<f;n++)if(t=i[n],t&&t[1]in document){for(n=0,r=t.length;n<r;n++)u[i[0][n]]=t[n];return u}return!1}(),t={request:function(t){var i=n.requestFullscreen;t=t||document.documentElement;/5\.1[\.\d]* Safari/.test(navigator.userAgent)?t[i]():t[i](r&&Element.ALLOW_KEYBOARD_INPUT)},exit:function(){document[n.exitFullscreen]()},toggle:function(n){this.isFullscreen?this.exit():this.request(n)},raw:n};if(!n){i?module.exports=!1:window.screenfull=!1;return}Object.defineProperties(t,{isFullscreen:{get:function(){return!!document[n.fullscreenElement]}},element:{enumerable:!0,get:function(){return document[n.fullscreenElement]}},enabled:{enumerable:!0,get:function(){return!!document[n.fullscreenEnabled]}}});i?module.exports=t:window.screenfull=t})();var SCG={test:"test"};SCG.AI={};SCG.space=undefined;SCG.viewfield={"default":{width:500,height:300},width:500,height:300,current:undefined};SCG.canvas=undefined;SCG.canvasId="mainCanvas";SCG.canvasBg=undefined;SCG.canvasBgId="backgroundCanvas";SCG.canvasUI=undefined;SCG.canvasUIId="uiCanvas";SCG.context=undefined;SCG.contextBg=undefined;SCG.contextUI=undefined;SCG.gameLogics={isPaused:!1,isPausedStep:!1,gameOver:!1,wrongDeviceOrientation:!1,messageToShow:"",isMobile:!1,pausedFrom:undefined,pauseDelta:0,doPauseWork:function(n){this.isPaused&&this.pausedFrom==undefined?(this.pausedFrom=n,this.pauseDelta=0):this.pausedFrom==undefined||this.isPaused?this.pauseDelta!=0&&(this.pauseDelta=0):(this.pauseDelta=n-this.pausedFrom,this.pausedFrom=undefined)},pauseToggle:function(){SCG.gameLogics.isPaused=!SCG.gameLogics.isPaused;SCG.UI.invalidate();SCG.audio&&SCG.audio.playPause(SCG.gameLogics.isPaused)}};SCG.go=[];SCG.gameControls={scale:{times:1},selectedGOs:[],storage:{savePrefix:"SCG_save_",save:function(n,t){t!=undefined&&localStorage.setItem(this.savePrefix+n,JSON.stringify(t))},load:function(n){var t=localStorage.getItem(this.savePrefix+n);return t==null?undefined:JSON.parse(t)},list:function(){}},camera:{mode:"free",shiftSpeed:5,centeredOn:undefined,resetAfterUpdate:!1,preventModeSwitch:!1,shifts:{left:!1,right:!1,up:!1,down:!1},free:function(){this.preventModeSwitch||(SCG.gameControls.camera.mode="free",this.centeredOn=undefined)},center:function(n){if(!this.preventModeSwitch){var t=SCG.gameControls;n==undefined&&t.selectedGOs.length==1&&(n=t.selectedGOs[0]);n?(t.camera.mode="centered",this.centeredOn=n):this.free()}},reset:function(){var n=this.shifts;n.left=!1;n.right=!1;n.up=!1;n.down=!1},update:function(){var i=this.shifts,n=undefined,t,r;this.mode==="free"?(t=undefined,i.left&&(t=V2.left()),i.right&&(t=V2.right()),i.up&&(t!=undefined?t.add(V2.up()):t=V2.up()),i.down&&(t!=undefined?t.add(V2.down()):t=V2.down()),t!==undefined&&(r=t.mul(this.shiftSpeed),n=SCG.viewfield.current.topLeft.add(r))):this.mode==="centered"&&this.centeredOn!==undefined&&(n=this.centeredOn.position.substract(new V2(SCG.viewfield.default.width/2,SCG.viewfield.default.height/2)));this.resetAfterUpdate&&this.reset();n!=undefined&&(n.x<0&&(n.x=0),n.y<0&&(n.y=0),n.x+SCG.viewfield.current.size.x>SCG.space.width&&(n.x=SCG.space.width-SCG.viewfield.current.size.x),n.y+SCG.viewfield.current.size.y>SCG.space.height&&(n.y=SCG.space.height-SCG.viewfield.current.size.y),SCG.viewfield.current.update(n))}},mousestate:{position:new V2,delta:new V2,leftButtonDown:!1,rightButtonDown:!1,middleButtonDown:!1,timer:undefined,reset:function(){this.leftButtonDown=!1;this.rightButtonDown=!1;this.middleButtonDown=!1},stopped:function(){SCG.gameControls.mousestate.delta=new V2},toString:function(){return"position: "+this.position.toString()+"<br/>leftButtonDown: "+this.leftButtonDown},doClickCheck:function(){for(var n,u,t,i=SCG.gameControls,r=0;r<this.eventHandlers.click.length;r++)if(n=this.eventHandlers.click[r],n.renderBox!=undefined&&n.renderBox.isPointInside(i.mousestate.position)&&n.handlers!=undefined&&n.handlers.click!=undefined&&isFunction(n.handlers.click)){if(u=n.handlers.click.call(n),u&&u.preventBubbling)return;break}t=SCG.scenes.activeScene.game;t.clickHandler!=undefined&&isFunction(t.clickHandler)&&t.clickHandler(i.mousestate.position.division(i.scale.times))},eventHandlers:{click:[]}},keyboardstate:{altPressed:!1,shiftPressed:!1,ctrlPressed:!1},mouseDown:function(n){var t=SCG.gameControls.mousestate;if(n.type=="touchstart")n.originalEvent.changedTouches!=undefined&&n.originalEvent.changedTouches.length==1&&(t.leftButtonDown=!0);else switch(n.which){case 1:t.leftButtonDown=!0;break;case 2:t.middleButtonDown=!0;break;case 3:t.rightButtonDown=!0;break;default:t.reset()}},mouseOut:function(){SCG.gameControls.mousestate.reset()},mouseUp:function(n){var i=this,t=SCG.gameControls.mousestate;if(i.getEventAbsolutePosition(n),n.type=="touchstart")n.originalEvent.changedTouches!=undefined&&n.originalEvent.changedTouches.length==1&&(t.leftButtonDown=!1);else switch(n.which){case 1:t.leftButtonDown=!1;break;case 2:t.middleButtonDown=!1;break;case 3:t.rightButtonDown=!1;break;default:t.reset()}i.mousestate.doClickCheck();n.preventDefault()},mouseMove:function(n){var i=this,t=SCG.gameControls.mousestate,r=t.position.clone();i.getEventAbsolutePosition(n);t.delta=t.position.substract(r);SCG.debugger&&SCG.debugger.setValue(t.toString())},getEventAbsolutePosition:function(n){var t=pointerEventToXY(n);SCG.gameControls.mousestate.position=new V2(t.x-SCG.canvasUI.margins.left,t.y-SCG.canvasUI.margins.top)},orientationChangeEventInit:function(){var n=this;SCG.gameControls.permanentEventInit();addListenerMulti(window,"orientationchange resize",function(){n.graphInit()});SCG.gameLogics.isMobile=/Android|webOS|iPhone|iPad|iPod|BlackBerry|IEMobile|Opera Mini/i.test(navigator.userAgent);SCG.gameLogics.isMobile&&(setTimeout(function(){window.scrollTo(0,1)},100),addListenerMulti(document,"fullscreenchange webkitfullscreenchange mozfullscreenchange MSFullscreenChange",function(){n.graphInit()}));this.graphInit()},graphInit:function(){var t=SCG.gameLogics,n=SCG.viewfield,s,i,r,o;if(t.messageToShow="",t.wrongDeviceOrientation=!window.matchMedia("(orientation: landscape)").matches,t.wrongDeviceOrientation){t.messageToShow="wrong device orientation - portrait";return}if(s=window.innerWidth,s<n.default.width){t.messageToShow=String.format("width lesser than {3} (width: {0}, iH: {1}, iW: {2})",s,window.innerHeight,window.innerWidth,n.default.width);t.wrongDeviceOrientation=!0;return}var u=Math.max(document.documentElement.clientWidth,window.innerWidth||0),f=Math.max(document.documentElement.clientHeight,window.innerHeight||0),h=u/n.default.width,c=f/n.default.height,e=SCG.gameControls.scale;if(e.times=Math.min(h,c),e.times<1){t.messageToShow=String.format("window is to small (width: {0}, height: {1})",u,f);t.wrongDeviceOrientation=!0;return}n.width=n.default.width*e.times;n.height=n.default.height*e.times;i=0;r=0;n.width<u?r=Math.round((u-n.width)/2):n.height<f&&(i=Math.round((f-n.height)/2));this.setCanvasProperties(SCG.canvas,i,r);this.setCanvasProperties(SCG.canvasBg,i,r);this.setCanvasProperties(SCG.canvasUI,i,r);o=SCG.scenes.activeScene.backgroundRender;o!=undefined&&isFunction(o)&&o();SCG.UI.invalidate()},setCanvasProperties:function(n,t,i){var r=SCG.viewfield;setAttributes(n,{width:r.width,height:r.height,css:{width:r.width+"px",height:r.height+"px","margin-top":t+"px","margin-left":i+"px"}});n.width=r.width;n.height=r.height;n.margins={top:t,left:i}},permanentEventInit:function(){var n=this;document.addEventListener("keydown",function(t){n.permanentKeyDown(t)},!1);document.addEventListener("keyup",function(t){n.permanentKeyUp(t)},!1);addListenerMulti(SCG.canvasUI,"mousedown touchstar",function(t){absorbTouchEvent(t);t.type=="touchstart"&&n.mouseMove(t);n.mouseDown(t)});addListenerMulti(SCG.canvasUI,"mouseup touchend",function(t){absorbTouchEvent(t);n.mouseUp(t)});addListenerMulti(SCG.canvasUI,"mouseout touchleave",function(t){absorbTouchEvent(t);n.mouseOut(t)});addListenerMulti(SCG.canvasUI,"mousemove touchmove",function(t){absorbTouchEvent(t);n.mouseMove(t)});SCG.canvasUI.addEventListener("contextmenu",function(n){return n.preventDefault(),!1},!1)},permanentKeyDown:function(n){var t=this.keyboardstate;t.shiftPressed=n.shiftKey;t.ctrlPressed=n.ctrlKey;t.altPressed=n.altKey},permanentKeyUp:function(n){var t=this.keyboardstate;t.shiftPressed=n.shiftKey;t.ctrlPressed=n.ctrlKey;t.altPressed=n.altKey;switch(n.which){case 32:n.shiftKey?SCG.gameLogics.isPausedStep=!0:SCG.gameLogics.pauseToggle()}}};SCG.debugger={el:getDOMByClassName(".debugger"),initialized:!1,init:function(){this.el=getDOMByClassName(".debugger");this.el==undefined&&(this.el=appendDomElement(document.body,"div",{"class":"debugger"}));this.initialized=!0},clear:function(){this.setValue("")},setValue:function(n){this.initialized||this.init();this.el.innerHTML=n}};SCG.GO={};SCG.GO.GO=function(n){if(this.defaultInitProperties={},this.position=new V2,this.renderPosition=new V2,this.renderBox=undefined,this.alive=!0,this.static=!1,this.type="unidentifiedType",this.id="",this.size=new V2,this.renderSize=new V2,this.direction=new V2,this.speed=0,this.angle=0,this.context=undefined,this.contextName="context",this.img=undefined,this.imgPropertyName=undefined,this.selected=!1,this.playerControllable=!1,this.destination=undefined,this.path=[],this.mouseOver=!1,this.randomizeDestination=!1,this.randomizeDestinationRadius=new V2,this.setDeadOnDestinationComplete=!1,this.isCustomRender=!1,this.handlers={},this.isAnimated=!1,this.animation={totalFrameCount:0,framesInRow:0,framesRowsCount:0,frameChangeDelay:0,destinationFrameSize:new V2,sourceFrameSize:new V2,currentDestination:new V2,currentFrame:0,reverse:!1,paused:!1,loop:!1,animationTimer:undefined,animationEndCallback:function(){},frameChange:function(){var n=this.animation,t,i;if(!n.paused){if(n.reverse?n.currentFrame--:n.currentFrame++,!n.reverse&&n.currentFrame>n.totalFrameCount||n.reverse&&n.currentFrame<1)if(n.loop)n.currentFrame=n.reverse?n.totalFrameCount:1;else{n.animationEndCallback.call(this);return}t=Math.ceil(n.currentFrame/n.framesInRow);i=n.framesInRow-(t*n.framesInRow-n.currentFrame);n.currentDestination=new V2(i-1,t-1)}}},n==undefined)throw"SCG.GO.GO -> props are undefined";if(n.size==undefined||n.size.equal(new V2))throw"SCG.GO.GO -> size is undefined";extend(!0,this,n);this.isAnimated&&(this.size=this.animation.destinationFrameSize.clone(),this.animation.currentFrame=0,this.animation.animationTimer={lastTimeWork:new Date,delta:0,currentDelay:this.animation.frameChangeDelay,originDelay:this.animation.frameChangeDelay,doWorkInternal:this.animation.frameChange,context:this});SCG.GO.GO.counter[this.type]==undefined&&(SCG.GO.GO.counter[this.type]=0);this.id=this.type+ ++SCG.GO.GO.counter[this.type];this.creationTime=new Date;this.regClick();this.initializer!=undefined&&isFunction(this.initializer)&&this.initializer(this);this.img==undefined&&this.imgPropertyName!=undefined&&(this.img=SCG.images[this.imgPropertyName]);SCG.AI.worker&&SCG.AI.sendEvent({type:"created",message:{goType:this.type,id:this.id,position:this.position.clone()}})};SCG.GO.GO.counter={};SCG.GO.GO.prototype={constructor:SCG.GO.GO,beforeDead:function(){},setDead:function(){this.beforeDead();var n=SCG.gameControls.mousestate.eventHandlers,t=n.click.indexOf(this);t>-1&&n.click.splice(t,1);SCG.AI.worker&&SCG.AI.sendEvent({type:"removed",message:{goType:this.type,id:this.id}});this.alive=!1},isAlive:function(){return this.alive},render:function(){var t,f;if(!this.alive||!this.renderPosition)return!1;if(this.internalPreRender(),this.isCustomRender)this.customRender();else if(this.img!=undefined){var i=this.renderPosition,n=this.renderSize,r=this.destSourcePosition,e=this.size,u=this.context;this.isAnimated?(t=this.animation,u.drawImage(this.img,t.currentDestination.x*t.sourceFrameSize.x,t.currentDestination.y*t.sourceFrameSize.y,t.sourceFrameSize.x,t.sourceFrameSize.y,i.x-n.x/2,i.y-n.y/2,n.x,n.y)):r!=undefined?(f=this.destSourceSize?this.destSourceSize:this.size,u.drawImage(this.img,r.x,r.y,f.x,f.y,i.x-n.x/2,i.y-n.y/2,n.x,n.y)):u.drawImage(this.img,i.x-n.x/2,i.y-n.y/2,n.x,n.y)}this.internalRender()},customRender:function(){},internalPreRender:function(){},internalRender:function(){},update:function(n){var t=SCG.gameControls.scale;if(this.renderSize=this.size.mul(t.times),this.box=new Box(new V2(this.position.x-this.size.x/2,this.position.y-this.size.y/2),this.size),this.renderPosition=undefined,(SCG.viewfield.current.isIntersectsWithBox(this.box)||this.static)&&(this.renderPosition=this.position.add(this.static?new V2:SCG.viewfield.current.topLeft.mul(-1)).mul(t.times),this.renderBox=new Box(new V2(this.renderPosition.x-this.renderSize.x/2,this.renderPosition.y-this.renderSize.y/2),this.renderSize)),this.img==undefined&&this.imgPropertyName!=undefined&&(this.img=SCG.images[this.imgPropertyName],this.img==undefined))throw"Cant achieve image named: "+this.imgPropertyName;if(this.context==undefined&&this.contextName!=undefined&&(this.context=SCG.contexts[this.contextName],this.context==undefined))throw"Cant achieve context named: "+this.contextName;if(!this.static&&(!this.alive||SCG.gameLogics.isPaused||SCG.gameLogics.gameOver||SCG.gameLogics.wrongDeviceOrientation)||(this.mouseOver=!1,this.internalPreUpdate(n),!this.alive))return!1;if(this.destination&&(this.position.distance(this.destination)<=this.speed?this.setDestination():this.position.add(this.direction.mul(this.speed),!0)),this.destination==undefined)if(this.path.length>0)this.setDestination(this.path.shift());else if(this.setDeadOnDestinationComplete)return this.setDead(),!1;return this.isAnimated&&doWorkByTimer(this.animation.animationTimer,n),this.internalUpdate(n),this.alive?void 0:!1},internalPreUpdate:function(){},internalUpdate:function(){},setDestination:function(n){if(n!==undefined&&n instanceof V2){if(this.randomizeDestination){var t=this.randomizeDestinationRadius;n.add(new V2(getRandom(-t,t),getRandom(-t,t)),!0)}this.destination=n;this.direction=this.position.direction(this.destination)}else this.destination=undefined,this.direction=new V2},renderSelectBox:function(){var n=this.selectBoxColor;n===undefined&&(n={max:255,min:100,current:255,direction:1,step:1,colorPattern:"rgb({0},0,0)"},this.playerControllable&&(n.colorPattern="rgb(0,{0},0)"));this.renderBox.render({fill:!1,strokeStyle:String.format(n.colorPattern,n.current),lineWidth:2});(n.current>=n.max||n.current<=n.min)&&(n.direction*=-1);n.current+=n.step*n.direction},clickHandler:function(){},regClick:function(){if(this.handlers.click&&isFunction(this.handlers.click)){var n=SCG.gameControls.mousestate.eventHandlers;n.click.indexOf(this)==-1&&n.click.push(this)}}};SCG.GO.goBaseProperties={};SCG.GO.create=function(n,t){if(n==undefined)throw"SCG.GO.create -> name is empty";t==undefined&&(t={});var i=SCG.GO.goBaseProperties[n];if(i==undefined)throw"SCG.GO.create -> can't find base properties ba provided name "+n;return new SCG.GO.GO(extend(!0,{},i,t))};SCG.GO.register=function(n,t){if(n==undefined)throw"SCG.GO.register -> name is empty";if(t==undefined)throw"SCG.GO.register -> baseProperties is undefined";SCG.GO.goBaseProperties[n]=t};SCG.frameCounter={lastTimeCheck:new Date,checkDelta:1e3,prevRate:0,current:0,renderConsumption:{begin:new Date,end:new Date},visibleCount:0,draw:function(){var n=SCG.context;n.save();n.fillStyle="red";n.font="48px serif";n.fillText(this.prevRate,SCG.viewfield.width-60,40);n.font="24px serif";n.fillText(this.visibleCount,SCG.viewfield.width-60,80);SCG.gameLogics.messageToShow!=""&&(n.fillStyle="black",n.font="24px serif",n.fillText(SCG.gameLogics.messageToShow,10,40));SCG.frameCounter.visibleCount=0;n.restore()},doWork:function(n){n-this.lastTimeCheck>this.checkDelta?(this.prevRate=this.current,this.current=0,this.lastTimeCheck=n):this.current++;this.draw()}};SCG.src={};SCG.images={};SCG.contexts={};SCG.globals={addDefaultUIButtons:!0};SCG.customInitializaers=[];window.requestAnimFrame=function(){return window.requestAnimationFrame||window.webkitRequestAnimationFrame||window.mozRequestAnimationFrame||window.oRequestAnimationFrame||window.msRequestAnimationFrame||function(n){window.setTimeout(n,1e3/60)}}();SCG.initializer=function(n){var r=0,i=0;for(var t in SCG.src)i++;for(t in SCG.src)SCG.images[t]=new Image,SCG.images[t].onload=function(){++r>=i&&n()},SCG.images[t].src=SCG.src[t];i==0&&n()};SCG.customInitialization=function(){if(SCG.customInitializaers.length!=0)for(var n=0;n<SCG.customInitializaers.length;n++)isFunction(SCG.customInitializaers[n])&&SCG.customInitializaers[n]()};SCG.scenes={activeScene:undefined,scenes:{},selectScene:function(n,t){if(this.scenes[n]==undefined)throw String.format("Scene {0} not found!",n);this.activeScene&&this.activeScene.dispose&&this.activeScene.dispose();this.activeScene=this.scenes[n];var i=this.activeScene,r=SCG.gameControls.mousestate.eventHandlers;r.click=[];i.go.forEach(function(n){n.regClick()});SCG.contextBg&&(SCG.contextBg.clearRect(0,0,SCG.viewfield.width,SCG.viewfield.height),i.backgroundRender!=undefined&&isFunction(i.backgroundRender)&&i.backgroundRender());SCG.AI.initialize();i.ui=[];SCG.globals.addDefaultUIButtons&&SCG.UI.addDefaultUIButtons();SCG.contextUI&&SCG.UI.invalidate();SCG.space={width:i.space.width,height:i.space.height};i.start!=undefined&&isFunction(i.start)&&i.start(t)},registerScene:function(n){var t,i,r;if(n.name===undefined)throw"Can't register scene without name";if(t=n.gameObjectsBaseProperties,t!=undefined&&isArray(t))for(i=0;i<t.length;i++){if(r=t[i].type,SCG.GO.goBaseProperties[r]!=undefined)throw String.format("SCG.scenes.registerScene -> BaseProperty with type '{0} already registered'",r);SCG.GO.register(r,t[i])}this.scenes[n.name]={name:n.name,start:n.start!==undefined&&isFunction(n.start)?n.start:undefined,dispose:n.dispose!==undefined&&isFunction(n.dispose)?n.dispose:undefined,preMainWork:n.preMainWork!==undefined&&isFunction(n.preMainWork)?n.preMainWork.bind(this):undefined,afterMainWork:n.afterMainWork!==undefined&&isFunction(n.afterMainWork)?n.afterMainWork.bind(this):undefined,go:n.gameObjectGenerator!=undefined&&isFunction(n.gameObjectGenerator)?n.gameObjectGenerator():[],backgroundRender:n.backgroundRender!=undefined&&isFunction(n.backgroundRender)?n.backgroundRender:undefined,game:extend(!0,{},n.game),space:n.space?n.space:{width:SCG.viewfield.default.width,height:SCG.viewfield.default.height},ui:[],unshift:[]}}};SCG.AI.initialize=function(){SCG.AI.worker&&(SCG.AI.worker.terminate(),SCG.AI.worker=undefined,URL.revokeObjectURL(SCG.AI.blobURL));var n=SCG.scenes.activeScene.game;n&&n.AI&&(SCG.AI.blobURL=URL.createObjectURL(new Blob(["(","function(){var queue = [];\nconsole.log('worker start');\nvar queueProcesser =\n"+(n.AI.queueProcesser!=undefined&&isFunction(n.AI.queueProcesser)?n.AI.queueProcesser.toString():"function(){}")+"\nfunction processMessageQueue(){\nif(queue.length > 0){\nqueueProcesser();\n}\nsetTimeout(processMessageQueue, 100);\n}\nself.onmessage = function(e){\nvar msg = e.data;\nswitch(msg.command){\ncase 'event':\nqueue.push(msg.event);\nbreak;\ncase 'initialize':\nself.environment=msg.environment;\nself.importScripts(msg.url + 'utils.min.js');\nqueue.push({type: 'start', message: undefined})\nbreak;\ndefault:\nbreak;\n}\n}\nprocessMessageQueue();\n}",")()"],{type:"application/javascript"})),SCG.AI.worker=new Worker(SCG.AI.blobURL));SCG.AI.worker&&n.AI.messagesProcesser!=undefined&&isFunction(n.AI.messagesProcesser)&&(SCG.AI.worker.onmessage=function(t){n.AI.messagesProcesser(t.data)})};SCG.AI.initializeEnvironment=function(n){var t=document.location.href,i=t.indexOf("index");i!=-1&&(t=t.substring(0,i));SCG.AI.worker.postMessage({command:"initialize",environment:n,url:t})};SCG.AI.sendEvent=function(n){SCG.AI.worker.postMessage({command:"event",event:n})};SCG.UI={initialized:!1,invalidate:function(){if(SCG.contextUI){SCG.contextUI.clearRect(0,0,SCG.viewfield.width,SCG.viewfield.height);for(var n=SCG.scenes.activeScene,t=n.ui.length;t--;)n.ui[t].update(),n.ui[t].render()}},addDefaultUIButtons:function(){var u=SCG.scenes.activeScene,n=SCG.viewfield.default,t=SCG.GO.create("button",{position:new Vector2,isFullscreen:!1,transparency:.75,handlers:{click:function(){return this.isFullscreen=!this.isFullscreen,screenfull.toggle(document.documentElement),{preventBubbling:!0}}},internalUpdate:function(){var n=this.size,t=this.innerCanvasContext;t.clearRect(0,0,n.x,n.y);drawFigures(t,this.isFullscreen?[[new Vector2(0,n.y*.475),new Vector2(n.x*.475,0),new Vector2(n.x*.475,n.y*.475)],[new Vector2(n.x*.525,n.y*.525),new Vector2(n.x,n.y*.525),new Vector2(n.x*.525,n.y)]]:[[new Vector2(0,0),new Vector2(n.x*.75,0),new Vector2(0,n.y*.75)],[new Vector2(n.x*.25,n.y),new Vector2(n.x,n.y),new Vector2(n.x,n.y*.25)]],{alpha:this.transparency,fill:"darkgrey"})}}),i,r;t.position=new Vector2(n.width-t.size.x/2,n.height-t.size.y/2);u.ui.push(t);i=SCG.GO.create("button",{position:new Vector2,transparency:.75,handlers:{click:function(){return SCG.gameLogics.pauseToggle(),{preventBubbling:!0}}},internalUpdate:function(){var n=this.size,t=this.innerCanvasContext;t.clearRect(0,0,n.x,n.y);drawFigures(t,SCG.gameLogics.isPaused?[[new Vector2(n.x*.2,0),new Vector2(n.x*.8,n.y*.5),new Vector2(n.x*.2,n.y)]]:[[new Vector2(n.x*.2,0),new Vector2(n.x*.4,0),new Vector2(n.x*.4,n.y),new Vector2(n.x*.2,n.y)],[new Vector2(n.x*.6,0),new Vector2(n.x*.8,0),new Vector2(n.x*.8,n.y),new Vector2(n.x*.6,n.y)]],{alpha:this.transparency,fill:"darkgrey"})}});i.position=new Vector2(n.width-t.size.x-i.size.x/2,n.height-i.size.y/2);u.ui.push(i);SCG.audio&&(r=SCG.GO.create("button",{position:new Vector2,transparency:.75,handlers:{click:function(){return SCG.audio.muteToggle(),SCG.UI.invalidate(),{preventBubbling:!0}}},internalUpdate:function(){var n=this.size,t=this.innerCanvasContext;t.clearRect(0,0,n.x,n.y);drawFigures(t,SCG.audio.mute?[[new Vector2(n.x*.1,n.y*.3),new Vector2(n.x*.3,n.y*.3),new Vector2(n.x*.5,0),new Vector2(n.x*.5,n.y),new Vector2(n.x*.3,n.y*.7),new Vector2(n.x*.1,n.y*.7)]]:[[new Vector2(n.x*.1,n.y*.3),new Vector2(n.x*.3,n.y*.3),new Vector2(n.x*.5,0),new Vector2(n.x*.5,n.y),new Vector2(n.x*.3,n.y*.7),new Vector2(n.x*.1,n.y*.7)],[new Vector2(n.x*.55,n.y*.4),new Vector2(n.x*.65,n.y*.4),new Vector2(n.x*.65,n.y*.6),new Vector2(n.x*.55,n.y*.6)],[new Vector2(n.x*.75,n.y*.2),new Vector2(n.x*.85,n.y*.2),new Vector2(n.x*.85,n.y*.8),new Vector2(n.x*.75,n.y*.8)]],{alpha:this.transparency,fill:"darkgrey"})}}),r.position=new Vector2(n.width-t.size.x-i.size.x-r.size.x/2,n.height-r.size.y/2),u.ui.push(r))},initialize:function(){if(!this.initialized)for(var n=0;n<this.controls.length;n++)SCG.GO.register(this.controls[n].type,this.controls[n])},helpers:{createCanvas:function(n){n.innerCanvas=document.createElement("canvas");var t=n.innerCanvas;t.width=n.size.x;t.height=n.size.y;n.innerCanvasContext=t.getContext("2d");n.img=n.innerCanvas}}};SCG.UI.controls=[{type:"button",size:new Vector2(50,50),contextName:"contextUI",innerCanvas:undefined,transparency:1,static:!0,text:undefined,useInnerCanvas:!0,border:!1,initializer:function(n){var i,t,r,u;if(this.useInnerCanvas&&(SCG.UI.helpers.createCanvas(n),i=n.innerCanvasContext,t=this.text,t!=undefined)){if(r=0,t.autoSize){u=300;do u--,i.font=u+"px "+t.font,r=i.measureText(t.value).width;while(r>this.size.x*.8)}else i.font=t.font,r=i.measureText(t.value).width;t.color&&(i.fillStyle=t.color);i.fillText(t.value,this.size.x/2-r/2,this.size.y/2+u/2);i.rect(1,1,this.size.x-1,this.size.y-1);i.stroke()}},internalRender:function(){if(this.border){var t=this.renderPosition,n=this.renderSize;this.context.rect(t.x-n.x/2,t.y-n.y/2,n.x,n.y);this.context.stroke()}}},{type:"label",size:new V2(50,10),innerCanvas:undefined,contextName:"contextUI",static:!0,text:{value:"sample",format:undefined,font:"px Arial",size:20,color:"black",border:!1,align:"center"},initializer:function(n){SCG.UI.helpers.createCanvas(n)},internalUpdate:function(){var t=this.innerCanvasContext,r=this.size,n=this.text,i;t.clearRect(0,0,r.x,r.y);t.font=n.size+n.font;t.fillStyle=n.color;i=n.value;n.format&&(i=String.format(n.format,n.value));t.textAlign=n.align;t.textBaseline="middle";t.fillText(i,this.size.x/2,this.size.y/2);n.border&&(t.rect(1,1,this.size.x-1,this.size.y-1),t.stroke())}},{type:"image",contextName:"contextUI",size:new V2(50,50),static:!0}];SCG.UI.initialize();SCG.audio={pause:!1,initialized:!1,mute:!1,players:[],notes:{dur:{_1:1,_2:.5,_4:.25,_8:.125,_16:.0625,_32:.03125},pause:0},init:function(){var i,n,t;if(!this.initialized){try{window.AudioContext=window.AudioContext||window.webkitAudioContext;this.context=new AudioContext}catch(r){alert("Web Audio API is not supported in this browser")}for(i=["c","c_sh","d","d_sh","e","f","f_sh","g","g_sh","a","a_sh","h"],n=0;n<9;n++)for(this.notes["o"+n]={},t=0;t<12;t++)this.notes["o"+n][i[t]]=440*Math.pow(2,((n-4)*12+(t-9))/12);this.initialized=!0}},playPause:function(n){this.connectToggle(n)},muteToggle:function(){this.mute=!this.mute;this.connectToggle(this.mute)},connectToggle:function(n){for(var t=0;t<this.players.length;t++)this.players[t].connectToggle(n)},update:function(n){for(var t=this.players.length,i;t--;)i=this.players[t],i.update(n),i.isAlive||this.players.splice(t,1)},start:function(n){this.initialized||this.init();n.context=this.context;n.mute=this.mute;this.players.push(new SCG.audio.Player(n))}};SCG.audio.init();SCG.audio.Player=function(n){if(this.loop=!1,this.notes=[],this.noteIndex=-1,this.curVol=0,this.maxVol=.05,this.context=undefined,this.gainNodes=[],this.currentNote=undefined,this.isAlive=!0,this.length=1e3,this.type="triangle",this.notesChangeTimer={ignorePause:!0,lastTimeWork:new Date,delta:0,currentDelay:0,originDelay:0,doWorkInternal:undefined,context:undefined},n==undefined)throw"SCG.audio.Player -> props are undefined";extend(!0,this,n);this.notesChangeTimer.doWorkInternal=this.noteChange;this.notesChangeTimer.context=this;this.curVol=this.maxVol;this.noteIndex=-1;this.noteChange()};SCG.audio.Player.prototype={constructor:SCG.audio.Player,update:function(n){this.isAlive&&doWorkByTimer(this.notesChangeTimer,n)},noteChange:function(){if(this.isAlive){if(this.noteIndex++,this.noteIndex>=this.notes.length)if(this.loop)this.noteIndex=0;else{this.isAlive=!1;return}this.setValues(this.notes[this.noteIndex])}},setValues:function(n){var r=[],f,u,i,t;for(this.gainNodes=[],isArray(n.value)?r=n.value:r.push(n.value),f=n.duration*this.length,u=0;u<r.length;u++)r[u]!=0&&(i=this.context.createOscillator(),t=this.context.createGain(),this.mute||(i.connect(t),t.connect(this.context.destination)),i.type=this.type,t.gain.value=this.maxVol,t.gain.setValueAtTime(this.curVol,this.context.currentTime),t.gain.exponentialRampToValueAtTime(.0001,this.context.currentTime+f*3/1e3),i.frequency.value=r[u],this.gainNodes.push(t),i.start(0),i.stop(this.context.currentTime+n.duration*4),i.onended=function(){t.disconnect()});this.notesChangeTimer.originDelay=f;this.notesChangeTimer.currentDelay=f},connectToggle:function(n){this.mute=n;for(var t=0;t<this.gainNodes.length;t++)n?this.gainNodes[t].disconnect(this.context.destination):this.gainNodes[t].connect(this.context.destination)}};SCG.start=function(){SCG.canvasBg||(SCG.canvasBg=appendDomElement(document.body,"canvas",{width:SCG.viewfield.width,height:SCG.viewfield.height,id:SCG.canvasBgId,css:{"z-index":0,position:"absolute"}}),SCG.contextBg=SCG.canvasBg.getContext("2d"),SCG.contexts.contextBg=SCG.contextBg);SCG.canvas||(SCG.canvas=appendDomElement(document.body,"canvas",{width:SCG.viewfield.width,height:SCG.viewfield.height,id:SCG.canvasId,css:{"z-index":1,position:"absolute"}}),SCG.context=SCG.canvas.getContext("2d"),SCG.contexts.context=SCG.context);SCG.canvasUI||(SCG.canvasUI=appendDomElement(document.body,"canvas",{width:SCG.viewfield.width,height:SCG.viewfield.height,id:SCG.canvasUIId,css:{"z-index":2,position:"absolute"}}),SCG.contextUI=SCG.canvasUI.getContext("2d"),SCG.contexts.contextUI=SCG.contextUI);SCG.initializer(function(){SCG.space==undefined&&(SCG.space={width:SCG.viewfield.default.width,height:SCG.viewfield.default.height});SCG.viewfield.current=new Box(new Vector2,new Vector2(SCG.viewfield.width,SCG.viewfield.height));SCG.customInitialization();SCG.gameControls.orientationChangeEventInit();SCG.UI.invalidate();SCG.audio&&SCG.audio.init();SCG.animate()})};SCG.preMainWork=function(){};SCG.afterMainWork=function(){};SCG.animate=function(){SCG.draw();requestAnimationFrame(SCG.animate)};SCG.draw=function(){var i,n,r,t,u;if(SCG.scenes.activeScene==undefined||SCG.scenes.activeScene.go==undefined)throw"Active scene corrupted!";if(i=new Date,SCG.gameLogics.doPauseWork(i),n=SCG.scenes.activeScene,n.preMainWork&&isFunction(n.preMainWork)&&n.preMainWork(),SCG.gameControls.camera.update(i),n.unshift.length>0){for(r=0;r<n.unshift.length;r++)n.go.unshift(n.unshift[r]);n.unshift=[]}for(t=n.go.length;t--;)n.go[t].update(i),n.go[t].render(),SCG.frameCounter&&n.go[t].renderPosition!=undefined&&SCG.frameCounter.visibleCount++,n.go[t].alive||(u=n.go.splice(t,1));n.afterMainWork&&isFunction(n.afterMainWork)&&n.afterMainWork();SCG.gameLogics.isPausedStep&&(SCG.gameLogics.isPausedStep=!1);SCG.frameCounter&&SCG.frameCounter.doWork(i);SCG.audio&&SCG.audio.update(i)};